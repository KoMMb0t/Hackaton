<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Battle Analytics Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .stat-value {
            font-size: 3em;
            font-weight: bold;
            color: #764ba2;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .rankings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .rankings-table th {
            background: #f5f5f5;
            padding: 12px;
            text-align: left;
            color: #667eea;
            font-weight: 600;
        }

        .rankings-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .rankings-table tr:hover {
            background: #f9f9f9;
        }

        .rank-1 {
            background: #ffd700 !important;
            font-weight: bold;
        }

        .rank-2 {
            background: #c0c0c0 !important;
        }

        .rank-3 {
            background: #cd7f32 !important;
        }

        .battle-log {
            max-height: 400px;
            overflow-y: auto;
        }

        .battle-item {
            padding: 15px;
            border-left: 4px solid #667eea;
            background: #f9f9f9;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .battle-item .winner {
            color: #28a745;
            font-weight: bold;
        }

        .battle-item .time {
            color: #999;
            font-size: 0.85em;
        }

        .start-battle-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .battle-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        select, button {
            padding: 12px 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
        }

        button {
            background: #667eea;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        button:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ Agent Battle Analytics Dashboard</h1>
            <p class="subtitle">
                <span class="status-indicator"></span>
                Live Battle Monitoring & Statistics
            </p>
        </header>

        <div id="message-container"></div>

        <!-- Statistiken -->
        <div class="grid">
            <div class="card">
                <h2>üìä Gesamt-K√§mpfe</h2>
                <div class="stat-value" id="total-battles">-</div>
                <div class="stat-label">Battles simuliert</div>
            </div>

            <div class="card">
                <h2>ü§ñ Aktive Agenten</h2>
                <div class="stat-value" id="total-agents">-</div>
                <div class="stat-label">Teilnehmer</div>
            </div>

            <div class="card">
                <h2>üèÜ Top Agent</h2>
                <div class="stat-value" style="font-size: 1.5em;" id="top-agent">-</div>
                <div class="stat-label" id="top-agent-wins">- Siege</div>
            </div>
        </div>

        <!-- Rangliste & Battle Log -->
        <div class="grid">
            <div class="card">
                <h2>üèÜ Rangliste</h2>
                <div id="rankings-container" class="loading">Lade Rangliste...</div>
            </div>

            <div class="card">
                <h2>üìú Letzte K√§mpfe</h2>
                <div id="battles-container" class="battle-log loading">Lade K√§mpfe...</div>
            </div>
        </div>

        <!-- Start Battle -->
        <div class="start-battle-section">
            <h2>‚öîÔ∏è Neuen Kampf starten</h2>
            <div class="battle-controls">
                <select id="agent1-select">
                    <option value="">Agent 1 w√§hlen...</option>
                </select>
                <select id="agent2-select">
                    <option value="">Agent 2 w√§hlen...</option>
                </select>
                <button id="start-battle-btn" onclick="startBattle()">Kampf starten!</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '';
        let agents = [];

        // Lade Daten beim Start
        async function loadData() {
            try {
                await Promise.all([
                    loadStatistics(),
                    loadRankings(),
                    loadRecentBattles()
                ]);
            } catch (error) {
                showError('Fehler beim Laden der Daten: ' + error.message);
            }
        }

        async function loadStatistics() {
            const response = await fetch(`${API_BASE}/api/statistics/overview`);
            const data = await response.json();

            document.getElementById('total-battles').textContent = data.total_battles || 0;
            document.getElementById('total-agents').textContent = data.total_agents || 0;
            document.getElementById('top-agent').textContent = data.top_agent || '-';
            document.getElementById('top-agent-wins').textContent = `${data.top_agent_wins || 0} Siege`;
        }

        async function loadRankings() {
            const response = await fetch(`${API_BASE}/api/agents/rankings`);
            const data = await response.json();

            agents = data.rankings || [];

            // Update Selects
            const agent1Select = document.getElementById('agent1-select');
            const agent2Select = document.getElementById('agent2-select');

            agent1Select.innerHTML = '<option value="">Agent 1 w√§hlen...</option>';
            agent2Select.innerHTML = '<option value="">Agent 2 w√§hlen...</option>';

            agents.forEach(agent => {
                agent1Select.innerHTML += `<option value="${agent.name}">${agent.name}</option>`;
                agent2Select.innerHTML += `<option value="${agent.name}">${agent.name}</option>`;
            });

            // Render Tabelle
            const container = document.getElementById('rankings-container');
            if (agents.length === 0) {
                container.innerHTML = '<p>Keine Daten verf√ºgbar</p>';
                return;
            }

            let html = '<table class="rankings-table"><thead><tr>';
            html += '<th>Rang</th><th>Agent</th><th>Siege</th><th>Niederlagen</th><th>Punkte</th>';
            html += '</tr></thead><tbody>';

            agents.forEach((agent, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                html += `<tr class="${rankClass}">`;
                html += `<td>${index + 1}</td>`;
                html += `<td>${agent.name}</td>`;
                html += `<td>${agent.wins}</td>`;
                html += `<td>${agent.losses}</td>`;
                html += `<td><strong>${agent.points}</strong></td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        async function loadRecentBattles() {
            const response = await fetch(`${API_BASE}/api/battles/recent?limit=10`);
            const data = await response.json();

            const container = document.getElementById('battles-container');
            if (!data.battles || data.battles.length === 0) {
                container.innerHTML = '<p>Keine K√§mpfe verf√ºgbar</p>';
                return;
            }

            let html = '';
            data.battles.forEach(battle => {
                const time = new Date(battle.timestamp).toLocaleString('de-DE');
                html += `<div class="battle-item">`;
                html += `<div><strong>${battle.agent1}</strong> vs <strong>${battle.agent2}</strong></div>`;
                html += `<div class="winner">üèÜ Sieger: ${battle.winner} (${battle.rounds} Runden)</div>`;
                html += `<div class="time">${time}</div>`;
                html += `</div>`;
            });

            container.innerHTML = html;
        }

        async function startBattle() {
            const agent1 = document.getElementById('agent1-select').value;
            const agent2 = document.getElementById('agent2-select').value;

            if (!agent1 || !agent2) {
                showError('Bitte beide Agenten ausw√§hlen!');
                return;
            }

            if (agent1 === agent2) {
                showError('Agenten m√ºssen unterschiedlich sein!');
                return;
            }

            const btn = document.getElementById('start-battle-btn');
            btn.disabled = true;
            btn.textContent = 'Kampf l√§uft...';

            try {
                const response = await fetch(`${API_BASE}/api/battle/start?agent1_name=${agent1}&agent2_name=${agent2}`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess(`üèÜ ${data.winner} gewinnt nach ${data.rounds} Runden!`);
                    // Reload data
                    await loadData();
                } else {
                    showError('Kampf fehlgeschlagen!');
                }
            } catch (error) {
                showError('Fehler: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Kampf starten!';
            }
        }

        function showError(message) {
            const container = document.getElementById('message-container');
            container.innerHTML = `<div class="error">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        function showSuccess(message) {
            const container = document.getElementById('message-container');
            container.innerHTML = `<div class="success">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        // Auto-refresh alle 10 Sekunden
        setInterval(loadData, 10000);

        // Initial load
        loadData();
    </script>
</body>
</html>
